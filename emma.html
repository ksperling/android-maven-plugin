<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-01-29 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160129" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Android Maven Plugin - 




Code coverage with Emma</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>

    
    <meta charset="UTF-8" /><!-- [if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"/><![endif] --><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Asciidoctor 1.5.0" />              </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="https://github.com/simpligility/android-maven-plugin">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="usage.html"  title="Usage">Usage</a>
</li>
                  
                      <li>      <a href="plugin-info.html"  title="Goals">Goals</a>
</li>
                  
                      <li>      <a href="examples.html"  title="Examples">Examples</a>
</li>
                  
                      <li>      <a href="ide-support.html"  title="IDE Support">IDE Support</a>
</li>
                  
                      <li>      <a href="changelog.html"  title="Changelog">Changelog</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How To's <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="adb-devices.html"  title="Device Interaction with ADB">Device Interaction with ADB</a>
</li>
                  
                      <li>      <a href="proguard.html"  title="Using Proguard">Using Proguard</a>
</li>
                  
                      <li>      <a href="sign.html"  title="Signing APK">Signing APK</a>
</li>
                  
                      <li>      <a href="playstore-publisher.html"  title="Publishing to Google Play Store">Publishing to Google Play Store</a>
</li>
                  
                      <li>      <a href="shaded-commons-codec.html"  title="Shading Example">Shading Example</a>
</li>
                  
                      <li>      <a href="instrumentation.html"  title="Instrumentation Example">Instrumentation Example</a>
</li>
                  
                      <li>      <a href="emma.html"  title="Test Code Coverage with Emma">Test Code Coverage with Emma</a>
</li>
                  
                      <li>      <a href="screenshots.html"  title="Automated Screenshots">Automated Screenshots</a>
</li>
                  
                      <li>      <a href="ndk.html"  title="NDK">NDK</a>
</li>
                  
                      <li>      <a href="native-deps.html"  title="Native Dependencies">Native Dependencies</a>
</li>
                  
                      <li>      <a href="scala.html"  title="Scala">Scala</a>
</li>
                  
                      <li>      <a href="apksources.html"  title="apksources">apksources</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="http://groups.google.com/group/maven-android-developers"  title="Maven Android Mailing List">Maven Android Mailing List</a>
</li>
                  
                      <li>      <a href="report-issue.html"  title="Report An Issue">Report An Issue</a>
</li>
                  
                      <li>      <a href="contributing.html"  title="Contributing">Contributing</a>
</li>
                  
                      <li>      <a href="contributors.html"  title="Contributors">Contributors</a>
</li>
                  
                      <li>      <a href="developing.html"  title="Developing">Developing</a>
</li>
                  
                      <li>      <a href="releasing.html"  title="Releasing">Releasing</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Related Projects <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="http://rgladwell.github.io/m2e-android/"  title="m2e-android">m2e-android</a>
</li>
                  
                      <li>      <a href="https://projects.eclipse.org/projects/tools.andmore"  title="Andmore">Andmore</a>
</li>
                  
                      <li>      <a href="https://github.com/simpligility/maven-android-sdk-deployer"  title="Maven Android SDK Deployer">Maven Android SDK Deployer</a>
</li>
                  
                      <li>      <a href="https://github.com/simpligility/android-ndk-maven-plugin/"  title="Android NDK Maven Plugin">Android NDK Maven Plugin</a>
</li>
                  
                      <li>      <a href="http://tools.android.com/"  title="Android Tools">Android Tools</a>
</li>
                  
                      <li>      <a href="http://maven.apache.org/"  title="Apache Maven">Apache Maven</a>
</li>
                  
                      <li>      <a href="http://eclipse.org/m2e/"  title="M2Eclipse">M2Eclipse</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="dependency-convergence.html"  title="Dependency Convergence">Dependency Convergence</a>
</li>
                                  <li>      <a href="dependency-info.html"  title="Dependency Information">Dependency Information</a>
</li>
                                  <li>      <a href="dependency-management.html"  title="Dependency Management">Dependency Management</a>
</li>
                                  <li>      <a href="distribution-management.html"  title="Distribution Management">Distribution Management</a>
</li>
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="mail-lists.html"  title="Mailing Lists">Mailing Lists</a>
</li>
                                  <li>      <a href="plugin-management.html"  title="Plugin Management">Plugin Management</a>
</li>
                                  <li>      <a href="plugins.html"  title="Project Plugins">Project Plugins</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Project Summary">Project Summary</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="plugin-info.html"  title="Plugin Documentation">Plugin Documentation</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                                  <li>      <a href="xref-test/index.html"  title="Test Source Xref">Test Source Xref</a>
</li>
                                  <li>      <a href="cpd.html"  title="CPD">CPD</a>
</li>
                                  <li>      <a href="pmd.html"  title="PMD">PMD</a>
</li>
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="cobertura/index.html"  title="Cobertura Test Coverage">Cobertura Test Coverage</a>
</li>
                                  <li>      <a href="findbugs.html"  title="FindBugs">FindBugs</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Android Maven Plugin - android-maven-plugin</h2>
                </div>
                      </div>
        <div class="pull-right">              <div id="bannerRight">
                                                                                                <img src="" />
                </div>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2016-01-29
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 4.4.2-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="usage.html" title="Usage">
          <span class="none"></span>
        Usage</a>
            </li>
                
      <li>
  
                          <a href="plugin-info.html" title="Goals">
          <span class="none"></span>
        Goals</a>
            </li>
                
      <li>
  
                          <a href="examples.html" title="Examples">
          <span class="none"></span>
        Examples</a>
            </li>
                
      <li>
  
                          <a href="ide-support.html" title="IDE Support">
          <span class="none"></span>
        IDE Support</a>
            </li>
                
      <li>
  
                          <a href="changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
                              <li class="nav-header">How To's</li>
                              
      <li>
  
                          <a href="adb-devices.html" title="Device Interaction with ADB">
          <span class="none"></span>
        Device Interaction with ADB</a>
            </li>
                
      <li>
  
                          <a href="proguard.html" title="Using Proguard">
          <span class="none"></span>
        Using Proguard</a>
            </li>
                
      <li>
  
                          <a href="sign.html" title="Signing APK">
          <span class="none"></span>
        Signing APK</a>
            </li>
                
      <li>
  
                          <a href="playstore-publisher.html" title="Publishing to Google Play Store">
          <span class="none"></span>
        Publishing to Google Play Store</a>
            </li>
                
      <li>
  
                          <a href="shaded-commons-codec.html" title="Shading Example">
          <span class="none"></span>
        Shading Example</a>
            </li>
                
      <li>
  
                          <a href="instrumentation.html" title="Instrumentation Example">
          <span class="none"></span>
        Instrumentation Example</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Test Code Coverage with Emma</a>
          </li>
                
      <li>
  
                          <a href="screenshots.html" title="Automated Screenshots">
          <span class="none"></span>
        Automated Screenshots</a>
            </li>
                
      <li>
  
                          <a href="ndk.html" title="NDK">
          <span class="none"></span>
        NDK</a>
            </li>
                
      <li>
  
                          <a href="native-deps.html" title="Native Dependencies">
          <span class="none"></span>
        Native Dependencies</a>
            </li>
                
      <li>
  
                          <a href="scala.html" title="Scala">
          <span class="none"></span>
        Scala</a>
            </li>
                
      <li>
  
                          <a href="apksources.html" title="apksources">
          <span class="none"></span>
        apksources</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="http://groups.google.com/group/maven-android-developers" class="externalLink" title="Maven Android Mailing List">
          <span class="none"></span>
        Maven Android Mailing List</a>
            </li>
                
      <li>
  
                          <a href="report-issue.html" title="Report An Issue">
          <span class="none"></span>
        Report An Issue</a>
            </li>
                
      <li>
  
                          <a href="contributing.html" title="Contributing">
          <span class="none"></span>
        Contributing</a>
            </li>
                
      <li>
  
                          <a href="contributors.html" title="Contributors">
          <span class="none"></span>
        Contributors</a>
            </li>
                
      <li>
  
                          <a href="developing.html" title="Developing">
          <span class="none"></span>
        Developing</a>
            </li>
                
      <li>
  
                          <a href="releasing.html" title="Releasing">
          <span class="none"></span>
        Releasing</a>
            </li>
                              <li class="nav-header">Related Projects</li>
                              
      <li>
  
                          <a href="http://rgladwell.github.io/m2e-android/" class="externalLink" title="m2e-android">
          <span class="none"></span>
        m2e-android</a>
            </li>
                
      <li>
  
                          <a href="https://projects.eclipse.org/projects/tools.andmore" class="externalLink" title="Andmore">
          <span class="none"></span>
        Andmore</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/simpligility/maven-android-sdk-deployer" class="externalLink" title="Maven Android SDK Deployer">
          <span class="none"></span>
        Maven Android SDK Deployer</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/simpligility/android-ndk-maven-plugin/" class="externalLink" title="Android NDK Maven Plugin">
          <span class="none"></span>
        Android NDK Maven Plugin</a>
            </li>
                
      <li>
  
                          <a href="http://tools.android.com/" class="externalLink" title="Android Tools">
          <span class="none"></span>
        Android Tools</a>
            </li>
                
      <li>
  
                          <a href="http://maven.apache.org/" class="externalLink" title="Apache Maven">
          <span class="none"></span>
        Apache Maven</a>
            </li>
                
      <li>
  
                          <a href="http://eclipse.org/m2e/" class="externalLink" title="M2Eclipse">
          <span class="none"></span>
        M2Eclipse</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                            
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            




<h1>Code coverage with Emma</h1>






<p>Emma is a tool which measures how many lines of code have been caused during testing.
Better explanation: <a class="bare" href="http://emma.sourceforge.net/">http://emma.sourceforge.net/</a></p>



<table border="0" class="table table-striped">

<tr class="a">

<td class="icon">
Important
</td>

<td class="content">
Emma takes your compiled java classes and adds Emma byte code. Emma divides your code
into blocks and adds emma counting methods. It is important to NOT submit your code with
emma methods to the Play store. If you submitted your code with emma byte code your apk will be larger
and less performant.
</td>
</tr>
</table>





<div class="section" id="_configuration">
<h2 id="_configuration">Configuration</h2>



<p>Add a emma profile to the project that we want to measure:</p>




<div>
<pre>&lt;build/&gt;

&lt;!-- un-commment when you want use sonar to present rules
&lt;properties&gt;
  &lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
  &lt;sonar.emma.reportPath&gt;target/emma/&lt;/sonar.emma.reportPath&gt;
  &lt;sonar.surefire.reportsPath &gt;../regalandroid-test/target/surefire-reports&lt;/sonar.surefire.reportsPath&gt;
  &lt;sonar.core.codeCoveragePlugin&gt;emma&lt;/sonar.core.codeCoveragePlugin&gt;
&lt;/properties&gt;
--&gt;

&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;emma&lt;/id&gt;
    &lt;build&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;com.simpligility.maven.plugins&lt;/groupId&gt;
          &lt;artifactId&gt;android-maven-plugin&lt;/artifactId&gt;
          &lt;configuration&gt;
            &lt;emma&gt;
              &lt;enable&gt;true&lt;/enable&gt;
              &lt;classFolders&gt;${project.basedir}/target/classes/&lt;/classFolders&gt;
              &lt;outputMetaFile&gt;${project.basedir}/target/emma/coverage.em&lt;/outputMetaFile&gt;
            &lt;/emma&gt;
            &lt;dex&gt;
              &lt;noLocals&gt;true&lt;/noLocals&gt; &lt;!--  must be set for emma --&gt;
            &lt;/dex&gt;
          &lt;/configuration&gt;
          &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/build&gt;
  &lt;/profile&gt;
&lt;/profiles&gt;</pre></div>




<p>emma.enable = true  = run emma instrumentation, modify compiled class by putting emma code to classes.</p>



<p>emma.classFolders = folder where are compiled classes.
emma.outputMetaFile = coverage.em - emma meta data file ( need for generating rapport - because of emma4it plugin the best place folder for this file is target/emma/ folder.</p>



<p>Important:
dex.noLocals - this need to be set for emma.</p>



<p>To run emma instrumentation:</p>




<div>
<pre>mvn clean install -Pemma</pre></div>




<p>from parent project.</p>



<p>This command will compile code with emma instrumentation.</p>



<p>Add the following to the pom file of the the test project:</p>




<div>
<pre>&lt;build/&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
    &lt;id&gt;emma&lt;/id&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;emma&lt;/groupId&gt;
          &lt;artifactId&gt;emma&lt;/artifactId&gt;
          &lt;version&gt;2.1.5320&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
            &lt;artifactId&gt;properties-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.0-alpha-1&lt;/version&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;phase&gt;initialize&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;read-project-properties&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                &lt;files&gt;
                &lt;!-- read project properties ( can be build.properties or default.properties
Most important property is tested.project.dir - should be path to project which we want measure coverage
--&gt;
                  &lt;file&gt;project.properties&lt;/file&gt;
                &lt;/files&gt;
              &lt;/configuration&gt;
            &lt;/execution&gt;
          &lt;/executions&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;com.simpligility.maven.plugins&lt;/groupId&gt;
          &lt;artifactId&gt;android-maven-plugin&lt;/artifactId&gt;
          &lt;configuration&gt;
            &lt;test&gt;
            &lt;!-- Run test with flag &quot;-w coverage true&quot; this is need for generate coverage.ec file, result file--&gt;
              &lt;coverage&gt;true&lt;/coverage&gt;
              &lt;createReport&gt;true&lt;/createReport&gt;
            &lt;/test&gt;
          &lt;/configuration&gt;
          &lt;extensions&gt;true&lt;/extensions&gt;
          &lt;!-- need for pull coverage.ec file and move to tested project--&gt;
          &lt;executions&gt;
            &lt;execution&gt;
              &lt;id&gt;pull-coverage&lt;/id&gt;
              &lt;phase&gt;post-integration-test&lt;/phase&gt;
              &lt;goals&gt;
                &lt;goal&gt;pull&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;configuration&gt;
                &lt;pullSource&gt;/data/data/com.example.android.apis/files/coverage.ec&lt;/pullSource&gt;
                &lt;pullDestination&gt;${tested.project.dir}/target/emma/coverage.ec&lt;/pullDestination&gt;
              &lt;/configuration&gt;
            &lt;/execution&gt;
          &lt;/executions&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;reporting&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;!-- Plugin for generate report - if you want use sonar you could skip this raport plugin --&gt;
          &lt;groupId&gt;org.sonatype.maven.plugin&lt;/groupId&gt;
          &lt;artifactId&gt;emma4it-maven-plugin&lt;/artifactId&gt;
          &lt;version&gt;1.3&lt;/version&gt;
          &lt;configuration&gt;
            &lt;metadatas&gt;${tested.project.dir}/target/emma/coverage.em,${tested.project.dir}/src/&lt;/metadatas&gt;
            &lt;instrumentations&gt;${tested.project.dir}/target/emma/coverage.ec&lt;/instrumentations&gt;
            &lt;reportDirectory&gt;${tested.project.dir}/target/emma/&lt;/reportDirectory&gt;
            &lt;baseDirectory&gt;${tested.project.dir}/target/&lt;/baseDirectory&gt;
            &lt;formats&gt;xml,html&lt;/formats&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/reporting&gt;
  &lt;/profile&gt;
&lt;/profiles&gt;</pre></div>




<p>To run emma instrumentation and measure test coverage:</p>




<div>
<pre>mvn clean install -Pemma</pre></div>




<p>from parent project.</p>



<p>This command will compile code with emma instrumentation and run integration tests with
flag &quot;-w coverage true&quot; and generate coverage.ec file
and pull coverage.ec file to ${tested.project.dir}/target/emma/</p>



<p>When all tests are successful finished we should have in folder:
 ${tested.project.dir}/target/emma/
coverage.em file ( around more then 1MB)
coverage.ec file ( more then 37B ) 37B = empty file</p>



<p>When we have this two files we can generate report (sonar or report plugin)</p>




</div>
<div class="section" id="_how_to_present_emma_coverage_result">
<h2 id="_how_to_present_emma_coverage_result">How to present emma coverage result</h2>



<p>We have more then one:
===Sonar (<i>thanks for Anthony Dahanne (anthonydahanne) for help configure sonnar</i>) ===
We cam enable emma plugin in sonar by adding properties to our project:
{{{</p>



<p>&lt;properties&gt;
    &lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
    &lt;sonar.emma.reportPath&gt;target/emma/&lt;/sonar.emma.reportPath&gt;
    &lt;sonar.surefire.reportsPath &gt;../<a href="#TestProjectFolder">[TestProjectFolder]</a>/target/surefire-reports&lt;/sonar.surefire.reportsPath&gt;
    &lt;sonar.core.codeCoveragePlugin&gt;emma&lt;/sonar.core.codeCoveragePlugin&gt;
&lt;/properties&gt;</p>



<p>}}}
This properties are need to force use coverage.ec and coverage.em files and not run sonar re instrument code by emma plugin in Sonar.</p>



<div class="section" id="_report_plugin">
<h3 id="_report_plugin">Report plugin</h3>


<p>{{{
mvn org.sonatype.maven.plugin:emma4it-maven-plugin:1.3:report
}}}
from parent project.
Report will be generated:
 ${tested.project.dir}/target/site/emma/index.html</p>



<p>Because plugin emma4it has some bugs ( or I can&#x2019;t configure emma4it correctly) only base report will be generated.
To generate full report ( each line will be marked if is covered or not ) please use shell:
{{{
java -cp ${emmaDirectory}/emma.jar emma report -r html -in coverage.em,coverage.ec -sp ${project.source.folder}
}}}</p>





<h1 id="_emma_from_shell" class="sect0">Emma from shell</h1>


<p>theoretically you can run emma from shell:</p>



<p>(C1):
{{{
java -cp ${emmaDirectory}/emma.jar emma instr -m overwrite -cp ${jar_file/folder_with_compiled_sources}
}}}
example:
(C2):
{{{
java -cp /androidsources/external/emma/lib/emma.jar emma instr -m overwrite -cp project-1.0-SNAPSHOT.jar
}}}</p>



<p>This will generate <b>coverage.em</b> file - metadata file with information about your code and this command mixing emma bytecode with your bytecode.</p>



<p>Next you must compile generated bytecode by dex, then package to apk.
Install apk to emulator/device.
Then run test with coverage flag.Example:
(C3):
{{{
adb shell am instrument <b>-e coverage true</b> -w com.arnav.test/pl.polidea.instrumentation.PolideaInstrumentationTestRunne
}}}</p>



<p>Command C3 - will generate coverage.ec file on device in /data/data/${project}/files/coverage.ec</p>



<p>coverage.ec file has information about which block was called during tests.</p>



<p>When we have this two files: coverage.ec, coverage.em we can generate nice report:
(C4):
{{{
java -cp ${emmaDirectory}/emma.jar emma report -r html -in coverage.em,coverage.ec -sp ${project.source.folder}
}}}
In command C4, option -sp is optional - when you use this option, report will be more detailed - because each line of code will be marked.</p>


</div></div>
<div class="section" id="_emma_compile_process">
<h2 id="_emma_compile_process">Emma compile process</h2>



<p>When we use maven-android-plugin without emma profile:
{{{
mvn clean compile install
}}}
Then:
  #. maven clean target folder and temporary folder
  #. maven use javac to compile sources &#x2192; to target/classes/ folder
  #. maven use dex command to convert java byte code to dex format &#x2192; targer/classes.dex
  #.classees.dex and resources are package to targer/.apk
  #. (1-4) for integration test.
  #. apk file are install to device
  #. integration test are started.</p>



<p>When we use maven-android-plugin with emma profile:
{{{
mvn clean compile install -Pemma
}}}
Then:
  #. maven clean target folder and temporary folder
  #. maven use javac to compile sources &#x2192; to target/classes/ folder
  #. <b>emma.jar is run - and we inject emma code to java byte code. This command generate coverage.em file - meta-data file which collect name of all class and function in our project</b>
  #. maven use dex command to convert java byte code to dex format &#x2192; targer/classes.dex
  #. classees.dex and resources are package to targer/.apk
  #. (1-5) for integration test.
  #. apk file are install to device
  #. integration test are started with flag <b>coverage true</b> and after this command on device in folder <b>/data/data/${project}/files/coverage.ec</b> is generated</p>






Last updated 2016-01-29 12:21:08 PST


</div>

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2008&#x2013;2016
                        <a href="http://www.simpligility.com">simpligility technologies inc.</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>